---
title: "3_ClassificationModels"
author: "massaine"
date: "2022-11-30"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Introduction

### Accuracy of PT methods
```{r}
options(stringsAsFactors=FALSE)
library(prospectr)
library(caret)
library(mlbench)
library(pROC)
library(C50)
library(stringr)
library(dplyr)
library(gt)
```

```{r, eval=FALSE}
NIR <- "SCIO"
load(file=here::here("output","dadosSCIO_PT.RData"))

#NIR <- "BUCHI"
#load(file=here::here("output","dadosBUCHI_PT.RData"))
```

### test using PLS model
```{r}
ctrl <- trainControl(method="repeatedcv",repeats = 5) 
```

### KNN model to test pre treatment methods
```{r, eval = F}
trait <- "Waxy"
modelFit2 <- list()
j=1
for (j in 1:9) {
  dados <- dados2[[j]]
  set.seed(2304)
  modelFit1 <- train(Waxy ~ ., data = dados, method = "knn",
                     trControl = ctrl,preProcess = c("center","scale"),
                     tuneLength = 1)
  modelFit2[[j]] <- modelFit1
  }

```

### results
```{r, eval = F}
res <- resamples(modelFit2)
res <- res$values
resCV_1 <- list()

for(i in 1:9){
  resCV_1[[i]]<-res[,c(paste(paste("Model",i,sep=""),"~Accuracy",sep=""),
                         paste(paste("Model",i,sep =""),"~Kappa",sep=""))]
  colnames(resCV_1[[i]]) <- c("Accuracy","Kappa")
  }

resCV_2 <- do.call(rbind,resCV_1)
resCV_2$PT <- rep(c(1:9),each=50)
resCV_2$PT <- as.factor(paste("pt",resCV_2$PT,sep = "_"))
levels(resCV_2$PT) <- c("raw data", "1st","DT","MSC","SNV","1st + DT",
                        "1st + MSC","DT + MSC", "1st + SG + DT")
```

### Save and load results 
```{r}
#PT_BUCHI <- resCV_2
#PT_SCIO <- resCV_2

#save(PT_SCIO,PT_BUCHI,file = here::here("output","Results_PreTreat.RData"))
load(file = here::here("output","Results_PreTreat.RData"))
```


### plot 
```{r}

#ggplot(PT_BUCHI, aes(x=PT, y=Accuracy, fill=PT)) + 
#  geom_boxplot()   + theme_bw() + ylim(.6, 1) + ggtitle("BUCHI")
 
#ggplot(PT_BUCHI, aes(x=PT, y=Kappa, fill=PT)) + 
#  geom_boxplot() + theme_bw() + ylim(.9, 1) + ggtitle("BUCHI")

ggplot(PT_SCIO, aes(x=PT, y=Accuracy, fill=PT)) + 
  geom_boxplot()   + theme_bw() + ylim(.8, 1) + ggtitle("SCIO")
 
ggplot(PT_SCIO, aes(x=PT, y=Kappa, fill=PT)) + 
  geom_boxplot() + theme_bw() + ylim(0, .8) + ggtitle("SCIO")

```

### table BUCHI
```{r, eval=F}
 PT_BUCHI%>%group_by(PT)%>%
   summarise(ROCm = round(mean(ROC, na.rm = T),3),
            ROC.sd = round(sd(ROC, na.rm = T),3),
            Spec.m = round(mean(Spec, na.rm = T),3),
            Spec.sd = round(sd(Spec, na.rm = T),3),
            Sens.m = round(mean(Sens, na.rm = T),3),
            Sens.sd = round(sd(Sens, na.rm = T),3)) %>%
       gt()  %>%     tab_options(table.font.size = pct(75))
```

### table SCIO
```{r}

 PT_SCIO%>%group_by(PT)%>%
   summarise(Accm = round(mean(Accuracy, na.rm = T),3),
            Acc.sd = round(sd(Accuracy, na.rm = T),3),
            Kap.m = round(mean(Kappa, na.rm = T),3),
            Kap.sd = round(sd(Kappa, na.rm = T),3)) %>%
       gt()  %>%     tab_options(table.font.size = pct(75))

```

